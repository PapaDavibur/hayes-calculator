<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Calculadora de Materiales para Hayes Motorworks - Calcula materiales y precios de piezas de veh√≠culos">
  <meta name="keywords" content="Hayes Motorworks, calculadora, materiales, autopartes">
  <title>Calculadora de Materiales - Hayes Motorworks</title>
  <script src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js" defer></script>
  <style>
    /* ========================================
       VARIABLES CSS
       ======================================== */
    :root {
      --accent: #19C1FF;        /* Color principal (azul cyan) */
      --taka-color: #FF69B4;    /* Color para bot√≥n TAKA (rosa) */
      --bg: #0a0a0a;            /* Fondo oscuro */
      --panel: #111;            /* Fondo de paneles */
      --text: #fff;             /* Color de texto */
      --border: #222;           /* Color de bordes */
    }

    /* ========================================
       RESET Y BASE
       ======================================== */
    * { 
      box-sizing: border-box; 
      margin: 0; 
      padding: 0; 
    }

    body {
      background: var(--bg);
      color: var(--text);
      font-family: 'Poppins', Arial, sans-serif;
      padding: 20px;
      line-height: 1.6;
    }

    /* ========================================
       LOGO Y T√çTULO
       ======================================== */
    .logo {
      display: block;
      margin: 10px auto;
      width: 260px;
      max-width: 60vw;
      filter: drop-shadow(0 0 10px var(--accent));
    }

    h1 {
      color: var(--accent);
      text-align: center;
      text-shadow: 0 0 10px var(--accent);
      margin-bottom: 10px;
      font-weight: 700;
      font-size: 1.8rem;
    }

    /* ========================================
       BOTONES DE ACCI√ìN
       ======================================== */
    .actions {
      display: flex;
      justify-content: center;
      gap: 12px;
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .btn {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
      border-radius: 8px;
      padding: 8px 14px;
      cursor: pointer;
      font-weight: 600;
      transition: all .2s;
      font-size: .95rem;
    }

    .btn:hover {
      background: rgba(25, 193, 255, .08);
      box-shadow: 0 0 10px rgba(25, 193, 255, .4);
      transform: translateY(-1px);
    }

    /* Bot√≥n TAKA con estilo especial */
    .btn-taka {
      color: var(--taka-color);
      border-color: var(--taka-color);
    }

    .btn-taka:hover {
      background: rgba(255, 105, 180, .08);
      box-shadow: 0 0 10px rgba(255, 105, 180, .4);
    }

    /* Bot√≥n AICHA con estilo especial */
    .btn-aicha {
      color: #FFD700;
      border-color: #FFD700;
    }

    .btn-aicha:hover {
      background: rgba(255, 215, 0, .08);
      box-shadow: 0 0 10px rgba(255, 215, 0, .4);
    }

    /* ========================================
       GRID DE SECCIONES
       ======================================== */
    .sections {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
      align-items: flex-start;
    }

    /* Contenedor para Rendimiento y Kit de Limpieza */
    .rendimiento-container {
      display: flex;
      flex-direction: column;
      gap: 22px;
      width: 360px;
      max-width: 100%;
    }

    /* ========================================
       TARJETAS DE CATEGOR√çAS
       ======================================== */
    .card {
      background: var(--panel);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 14px;
      min-width: 320px;
      max-width: 100%;
      box-shadow: 0 0 15px rgba(25, 193, 255, .25);
      transition: box-shadow .2s, transform .2s;
    }

    .card:hover {
      box-shadow: 0 0 25px rgba(25, 193, 255, .5);
      transform: translateY(-2px);
    }

    /* Tarjeta ancha para cosm√©ticos */
    .card.wide { 
      min-width: 500px; 
    }

    .card h2 {
      margin: 0 0 10px;
      color: var(--accent);
      border-bottom: 1px solid var(--accent);
      padding-bottom: 6px;
      font-size: 1.05rem;
      text-align: center;
      text-transform: uppercase;
      letter-spacing: .5px;
    }

    /* ========================================
       ITEMS DE PIEZAS
       ======================================== */
    .item {
      display: grid;
      grid-template-columns: 1fr auto;
      align-items: center;
      gap: 4px;
      padding: 6px 0;
      border-bottom: 1px solid var(--border);
      font-size: .95rem;
    }

    .item:last-child { 
      border-bottom: 0; 
    }

    /* ========================================
       LABELS Y CHECKBOXES
       ======================================== */
    label {
      display: flex;
      align-items: center;
      gap: 6px;
      cursor: pointer;
      min-width: 0;
      user-select: none;
    }

    label span {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    input[type="checkbox"] {
      accent-color: var(--accent);
      transform: scale(1.2);
      cursor: pointer;
      flex-shrink: 0;
    }

    /* ========================================
       INPUTS NUM√âRICOS
       ======================================== */
    input[type="number"] {
      width: 50px;
      flex-shrink: 0;
      background: #0e0e0e;
      color: #fff;
      border: 1px solid var(--accent);
      border-radius: 6px;
      padding: 2px 4px;
      font-weight: 600;
      font-size: .9rem;
      text-align: center;
      display: none; /* Oculto por defecto */
    }

    /* Mostrar cuando est√° visible */
    input[type="number"].visible { 
      display: block; 
    }

    input[type="number"]:focus {
      outline: none;
      box-shadow: 0 0 6px var(--accent);
    }

    /* ========================================
       BOT√ìN FULL TUNNING
       ======================================== */
    .full-tunning-btn {
      display: block;
      width: 100%;
      background: transparent;
      border: 1px solid var(--accent);
      color: var(--accent);
      border-radius: 8px;
      padding: 8px;
      margin-top: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all .2s;
      text-align: center;
      font-size: .95rem;
    }

    .full-tunning-btn:hover {
      background: rgba(25, 193, 255, .08);
      box-shadow: 0 0 10px rgba(25, 193, 255, .4);
    }

    /* ========================================
       GRID DE COSM√âTICOS (2 COLUMNAS)
       ======================================== */
    .cosmeticos-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0 8px;
    }

    .cosmeticos-grid .item {
      display: grid;
      grid-template-columns: 1fr auto;
      border-bottom: 1px solid var(--border);
      padding: 6px 2px;
      min-width: 0;
      gap: 4px;
    }

    /* √öltimos 2 items sin borde */
    .cosmeticos-grid .item:nth-last-child(-n+2) { 
      border-bottom: 0; 
    }

    .cosmeticos-grid .item label { 
      min-width: 0; 
    }

    .cosmeticos-grid .item label span { 
      font-size: .88rem; 
    }

    /* ========================================
       RESUMEN (MATERIALES Y VENTAS)
       ======================================== */
    .summary {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      justify-content: center;
      align-items: flex-start;
      margin-top: 22px;
    }

    .totals, .sales {
      background: var(--panel);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 14px;
      box-shadow: 0 0 15px rgba(25, 193, 255, .35);
      width: 520px;
      max-width: 100%;
    }

    .totals h3, .sales h3 {
      margin: 0 0 10px;
      color: var(--accent);
      text-align: center;
      font-size: 1.1rem;
    }

    /* ========================================
       GRID DE MATERIALES
       ======================================== */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 8px 18px;
    }

    .mat {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 8px;
      padding: 6px 8px;
      background: #0e0e0e;
      border-radius: 8px;
      border: 1px solid var(--border);
      font-variant-numeric: tabular-nums;
    }

    .mat-info {
      display: flex;
      align-items: center;
      gap: 8px;
      flex: 1;
      min-width: 0;
    }

    /* Icono del material */
    .mat-icon {
      width: 40px;
      height: 40px;
      object-fit: contain;
      flex-shrink: 0;
      filter: drop-shadow(0 0 3px rgba(25, 193, 255, .3));
    }

    .mat-info span {
      font-size: .9rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .mat strong {
      color: var(--accent);
      font-size: 1.1rem;
      flex-shrink: 0;
    }

    /* ========================================
       FILAS DE VENTAS
       ======================================== */
    .sales .row {
      display: flex;
      justify-content: space-between;
      background: #0e0e0e;
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 8px 10px;
      margin-bottom: 8px;
    }

    /* Fila del total general */
    .sales .total {
      font-size: 1.15rem;
      border-color: var(--accent);
      font-weight: 600;
    }

    .sales .total strong { 
      color: var(--accent); 
    }

    /* ========================================
       NOTAS
       ======================================== */
    .note {
      display: block;
      text-align: center;
      color: #b8e7ff;
      opacity: .8;
      margin-top: 8px;
      font-size: .85rem;
    }

    /* ========================================
       POPUPS
       ======================================== */
    .popup-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, .8);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      backdrop-filter: blur(4px);
    }

    .popup {
      background: var(--panel);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 24px;
      max-width: 400px;
      width: 90%;
      box-shadow: 0 0 30px rgba(25, 193, 255, .5);
      animation: popupSlide .3s ease;
    }

    /* Popup m√°s ancho para TAKA */
    .popup.prices-popup {
      max-width: 900px;
      width: 95%;
    }

    /* Animaci√≥n de entrada */
    @keyframes popupSlide {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .popup h2 {
      color: var(--accent);
      text-align: center;
      margin: 0 0 10px;
      font-size: 1.5rem;
      text-shadow: 0 0 10px var(--accent);
    }

    .popup p {
      text-align: center;
      margin-bottom: 20px;
      opacity: .9;
    }

    /* Opciones de descuento */
    .discount-options {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-bottom: 20px;
    }

    .discount-btn {
      background: transparent;
      color: var(--accent);
      border: 2px solid var(--accent);
      border-radius: 8px;
      padding: 15px 20px;
      cursor: pointer;
      transition: all .2s;
      display: flex;
      justify-content: center;
      align-items: center;
      gap: 15px;
      font-weight: 600;
      font-size: .95rem;
      text-transform: uppercase;
    }

    .discount-btn:hover {
      background: rgba(25, 193, 255, .15);
      box-shadow: 0 0 15px rgba(25, 193, 255, .5);
      transform: translateX(5px);
    }

    /* Acciones del popup */
    .popup-actions {
      display: flex;
      gap: 10px;
      justify-content: center;
      flex-wrap: wrap;
    }

    .btn-close, .btn-remove {
      background: transparent;
      color: var(--accent);
      border: 1px solid var(--accent);
      border-radius: 8px;
      padding: 8px 16px;
      cursor: pointer;
      font-weight: 600;
      transition: all .2s;
    }

    .btn-close:hover, .btn-remove:hover {
      background: rgba(25, 193, 255, .08);
      box-shadow: 0 0 10px rgba(25, 193, 255, .4);
    }

    /* Bot√≥n remover descuento (rojo) */
    .btn-remove { 
      color: #f44; 
      border-color: #f44; 
    }

    .btn-remove:hover {
      background: rgba(255, 68, 68, .08);
      box-shadow: 0 0 10px rgba(255, 68, 68, .4);
    }

    /* ========================================
       RESPONSIVE (M√ìVIL)
       ======================================== */
    @media (max-width: 768px) {
      h1 { font-size: 1.4rem; }
      .card.wide { min-width: 320px; }
      .cosmeticos-grid { grid-template-columns: 1fr; }
      .grid { grid-template-columns: 1fr; }
    }

  </style>
</head>
<body x-data="calculator()">

  <!-- Logo -->
  <img src="https://i.postimg.cc/FRcwXPHk/LOGO-2.png" alt="Hayes Motorworks" class="logo">
  
  <!-- T√≠tulo principal -->
  <h1>Calculadora de Materiales ‚Äì Hayes Motorworks</h1>

  <!-- Botones de acci√≥n -->
  <div class="actions">
    <button class="btn" @click="selectAll()">MARCAR TODO</button>
    <button class="btn" @click="clearAll()">LIMPIAR TODO</button>
    <button class="btn" @click="showDiscountPopup = true">APLICAR DESCUENTO</button>
    <button class="btn btn-taka" @click="showPricesPopup = true">TAKA</button>
    <button class="btn btn-aicha" @click="showAichaPopup = true">AICHA</button>
  </div>

  <!-- Popup de Descuento -->
  <div x-show="showDiscountPopup" class="popup-overlay" @click="showDiscountPopup = false">
    <div class="popup" @click.stop>
      <h2>Descuento</h2>
      <p>Selecciona un descuento:</p>
      <div class="discount-options">
        <button class="discount-btn" @click="applyDiscount(20, 'Descuento 20%')">DESCUENTO 20%</button>
      </div>
      <div class="popup-actions">
        <button class="btn-remove" @click="removeDiscount()" x-show="discountActive">QUITAR DESCUENTO</button>
        <button class="btn-close" @click="showDiscountPopup = false">CERRAR</button>
      </div>
    </div>
  </div>

  <!-- Popup TAKA -->
  <div x-show="showPricesPopup" class="popup-overlay" @click="showPricesPopup = false">
    <div class="popup prices-popup" @click.stop>
      <h2>TAKA</h2>
      <img src="https://i.ibb.co/fzbkQSsm/taka-1.png" alt="TAKA" style="width:100%;border-radius:8px;">
      <div class="popup-actions" style="margin-top:20px;">
        <button class="btn-close" @click="showPricesPopup = false">CERRAR</button>
      </div>
    </div>
  </div>

  <!-- Popup AICHA -->
  <div x-show="showAichaPopup" class="popup-overlay" @click="showAichaPopup = false">
    <div class="popup prices-popup" @click.stop>
      <h2 style="color:#FFD700;text-shadow:0 0 10px rgba(255,215,0,.8);">AICHA</h2>
      <img src="https://i.postimg.cc/TYGt2tnc/AICHA.jpg" alt="AICHA" style="width:100%;border-radius:8px;">
      <div class="popup-actions" style="margin-top:20px;">
        <button class="btn-close" @click="showAichaPopup = false">CERRAR</button>
      </div>
    </div>
  </div>

  <!-- Secciones de piezas -->
  <div class="sections">
    
    <!-- Partes Principales -->
    <div class="card">
      <h2>Partes Principales</h2>
      <template x-for="(mats, name) in data.principales" :key="name">
        <div class="item">
          <label>
            <input type="checkbox" x-model="selected[name]" @change="updateQty(name)">
            <span x-text="name"></span>
          </label>
          <input type="number" min="1" x-model.number="quantities[name]" @input="calc()" :class="{'visible':selected[name]}">
        </div>
      </template>
    </div>

    <!-- Partes de Servicio -->
    <div class="card">
      <h2>Partes de Servicio</h2>
      <template x-for="(mats, name) in data.servicio" :key="name">
        <div class="item">
          <label>
            <input type="checkbox" x-model="selected[name]" @change="updateQty(name)">
            <span x-text="name"></span>
          </label>
          <input type="number" min="1" x-model.number="quantities[name]" @input="calc()" :class="{'visible':selected[name]}">
        </div>
      </template>
    </div>

    <!-- Kits -->
    <div class="rendimiento-container">
      <!-- Rendimiento -->
      <div class="card">
        <h2>Rendimiento</h2>
        <template x-for="(mats, name) in data.rendimiento" :key="name">
          <div class="item">
            <label>
              <input type="checkbox" x-model="selected[name]" @change="updateQty(name)">
              <span x-text="name"></span>
            </label>
            <input type="number" min="1" x-model.number="quantities[name]" @input="calc()" :class="{'visible':selected[name]}">
          </div>
        </template>
        <button class="full-tunning-btn" @click="toggleFullTunning()">FULL TUNNING</button>
        <small class="note">Activa o desactiva todas las piezas de rendimiento.</small>
      </div>

      <!-- Kits -->
      <div class="card">
        <h2>Kits</h2>
        <template x-for="(mats, name) in data.kits" :key="name">
          <div class="item">
            <label>
              <input type="checkbox" x-model="selected[name]" @change="updateQty(name)">
              <span x-text="name"></span>
            </label>
            <input type="number" min="1" x-model.number="quantities[name]" @input="calc()" :class="{'visible':selected[name]}">
          </div>
        </template>
      </div>
    </div>

    <!-- Cosm√©ticos -->
    <div class="card wide">
      <h2>Cosm√©ticos</h2>
      <div class="cosmeticos-grid">
        <template x-for="(mats, name) in data.cosmeticos" :key="name">
          <div class="item">
            <label>
              <input type="checkbox" x-model="selected[name]" @change="updateQty(name)">
              <span x-text="name"></span>
            </label>
            <input type="number" min="1" x-model.number="quantities[name]" @input="calc()" :class="{'visible':selected[name]}">
          </div>
        </template>
      </div>
    </div>

  </div>

  <!-- Resumen -->
  <div class="summary">
    
    <!-- Totales de Materiales -->
    <div class="totals">
      <h3>TOTALES DE MATERIALES</h3>
      <template x-if="Object.values(materialTotals).some(v => v > 0)">
        <div class="grid">
          <template x-for="mat in materialOrder" :key="mat">
            <template x-if="materialTotals[mat] > 0">
              <div class="mat">
                <div class="mat-info">
                  <img :src="materialImages[mat]" :alt="mat" class="mat-icon">
                  <span x-text="mat"></span>
                </div>
                <strong x-text="materialTotals[mat]"></strong>
              </div>
            </template>
          </template>
        </div>
      </template>
      <template x-if="!Object.values(materialTotals).some(v => v > 0)">
        <p class="note">Selecciona piezas para ver los materiales necesarios.</p>
      </template>
      <small class="note">Los totales se multiplican por la cantidad indicada por pieza.</small>
    </div>

    <!-- Total a Cobrar -->
    <div class="sales">
      <h3>TOTAL A COBRAR üí∞</h3>
      <div class="row">
        <span>Subtotal Principales</span>
        <strong x-text="fmt(salesSub.principales)"></strong>
      </div>
      <div class="row">
        <span>Subtotal Servicio</span>
        <strong x-text="fmt(salesSub.servicio)"></strong>
      </div>
      <div class="row">
        <span>Subtotal Kits</span>
        <strong x-text="fmt(salesSub.kits)"></strong>
      </div>
      <template x-if="discountActive">
        <div class="row" style="color:#4ade80;">
          <span x-text="'Descuento ' + discountName + ' (' + discountPercent + '%)'"></span>
          <strong x-text="fmt(-((salesSub.principales + salesSub.servicio + salesSub.kits) * (discountPercent / 100)))"></strong>
        </div>
      </template>
      <div class="row total">
        <span>Total General</span>
        <strong x-text="fmt(getTotal())"></strong>
      </div>
      <template x-if="missingPrices.length > 0">
        <small class="note">Sin precio: <span x-text="missingPrices.join(', ')"></span></small>
      </template>
    </div>

  </div>

  <script>
    // ==========================================
    // EFECTO DE NIEVE NAVIDE√ëA
    // ==========================================
    function createSnowflakes() {
      const snowflakeChars = ['‚ùÑ', '‚ùÖ', '‚ùÜ'];
      const snowflakeCount = 50; // Cantidad de copos iniciales
      
      // Crear primeros 50 copos (caen m√°s r√°pido)
      for (let i = 0; i < snowflakeCount; i++) {
        setTimeout(() => {
          const snowflake = document.createElement('div');
          snowflake.classList.add('snowflake');
          snowflake.innerHTML = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
          
          // Posici√≥n aleatoria horizontal
          snowflake.style.left = Math.random() * 100 + '%';
          
          // Tama√±o aleatorio
          const size = Math.random() * 1.5 + 0.5;
          snowflake.style.fontSize = size + 'em';
          
          // Duraci√≥n ajustada = ca√≠da moderada (6-10 segundos)
          const duration = Math.random() * 4 + 6;
          snowflake.style.animationDuration = duration + 's';
          
          // Sin retraso para ca√≠da inmediata
          snowflake.style.animationDelay = '0s';
          
          document.body.appendChild(snowflake);
          
          // Eliminar el copo despu√©s de que termine la animaci√≥n
          setTimeout(() => {
            snowflake.remove();
          }, duration * 1000);
        }, i * 50); // Crear copos m√°s r√°pido (cada 50ms)
      }
      
      // Crear nuevos copos continuamente (velocidad normal)
      setInterval(() => {
        const snowflake = document.createElement('div');
        snowflake.classList.add('snowflake');
        snowflake.innerHTML = snowflakeChars[Math.floor(Math.random() * snowflakeChars.length)];
        snowflake.style.left = Math.random() * 100 + '%';
        const size = Math.random() * 1.5 + 0.5;
        snowflake.style.fontSize = size + 'em';
        const duration = Math.random() * 10 + 10;
        snowflake.style.animationDuration = duration + 's';
        document.body.appendChild(snowflake);
        setTimeout(() => snowflake.remove(), duration * 1000);
      }, 500);
    }

    // Iniciar la nieve cuando cargue la p√°gina
    document.addEventListener('DOMContentLoaded', createSnowflakes);

    // ==========================================
    // CALCULADORA PRINCIPAL
    // ==========================================
    function calculator() {
      return {
        // ==========================================
        // ORDEN DE MATERIALES CON IM√ÅGENES
        // ==========================================
        materialOrder: [
          'COBRE',
          'PL√ÅSTICO',
          'GOMA',
          'PIEZAS ELECTR√ìNICAS',
          'ACERO',
          'ALUMINIO',
          'VIDRIO',
          'ACEITE SINT√âTICO',
          'LAT√ìN',
          'CHATARRA',
          '√ÅCIDO',
          'FIBRA DE CARBONO',
          'HIERRO'
        ],
        
        // URLs de las im√°genes de cada material
        materialImages: {
          'COBRE': 'https://i.postimg.cc/QxCnTRVG/cobre.png',
          'PL√ÅSTICO': 'https://i.postimg.cc/gkjBZfr9/plastico.png',
          'GOMA': 'https://i.postimg.cc/RVhbHjh8/goma.png',
          'PIEZAS ELECTR√ìNICAS': 'https://i.postimg.cc/vHTSVpTk/Electronica.png',
          'ACERO': 'https://i.postimg.cc/9F0N7v0n/acero.png',
          'ALUMINIO': 'https://i.postimg.cc/xT8FzW8F/aluminio.png',
          'VIDRIO': 'https://i.postimg.cc/VsDV5Ysc/vidrio.png',
          'ACEITE SINT√âTICO': 'https://i.postimg.cc/TY1HDZ17/Aceite.png',
          'LAT√ìN': 'https://i.postimg.cc/gcNTrYzf/laton.png',
          'CHATARRA': 'https://i.postimg.cc/2j2K3zks/chatarra.png',
          '√ÅCIDO': 'https://i.postimg.cc/fWBrkwzp/acido.png',
          'FIBRA DE CARBONO': 'https://i.postimg.cc/qBj5gkJF/fibra.png',
          'HIERRO': 'https://i.ibb.co/jPYhbS8d/hierro.png'
        },

        // ==========================================
        // BASE DE DATOS DE PIEZAS Y MATERIALES
        // ==========================================
        data: {
          // Partes principales del veh√≠culo (REORDENADAS)
          principales: {
            'Alternador': {'PIEZAS ELECTR√ìNICAS':3,'ALUMINIO':4,'ACERO':5},
            'Bloque Motor': {'GOMA':1,'LAT√ìN':2,'PIEZAS ELECTR√ìNICAS':3,'HIERRO':4,'ACERO':5},
            'Bomba de Direcci√≥n': {'ACEITE SINT√âTICO':2,'PIEZAS ELECTR√ìNICAS':3,'ALUMINIO':6,'ACERO':8},
            'Carrocer√≠a': {'GOMA':1,'LAT√ìN':2,'PIEZAS ELECTR√ìNICAS':3,'HIERRO':4,'ACERO':5},
            'Frenos': {'LAT√ìN':2,'GOMA':3,'ACERO':5},
            'Inyectores': {'PIEZAS ELECTR√ìNICAS':2,'LAT√ìN':2,'ALUMINIO':3,'ACERO':4},
            'Radiador': {'ACEITE SINT√âTICO':1,'VIDRIO':3,'ALUMINIO':5,'ACERO':6},
            'Tanque Gasolina': {'GOMA':1,'LAT√ìN':2,'PIEZAS ELECTR√ìNICAS':3,'HIERRO':4,'ACERO':5},
            'Transmisi√≥n': {'LAT√ìN':2,'ACEITE SINT√âTICO':3,'ALUMINIO':6,'ACERO':10},
            'Bater√≠a El√©ctrica': {'√ÅCIDO':5,'LAT√ìN':5,'ALUMINIO':6,'PIEZAS ELECTR√ìNICAS':7},
            'Motor El√©ctrico': {'FIBRA DE CARBONO':4,'PIEZAS ELECTR√ìNICAS':6,'LAT√ìN':7,'ACERO':8},
            'Rueda de Veh√≠culo': {'LAT√ìN':1,'FIBRA DE CARBONO':2,'ACERO':4,'GOMA':5}
          },

          // Partes de servicio/mantenimiento (REORDENADAS)
          servicio: {
            'Filtro de Aceite': {'GOMA':1,'ACEITE SINT√âTICO':1,'ACERO':2},
            'Buj√≠a': {'PIEZAS ELECTR√ìNICAS':1,'ACERO':2,'LAT√ìN':2},
            'Correa de Transmisi√≥n': {'ACERO':2,'GOMA':3},
            'Filtro de Aire': {'GOMA':1,'PL√ÅSTICO':2},
            'Filtro de Combustible': {'GOMA':1,'ACERO':2,'PL√ÅSTICO':2},
            'L√≠quido de Direcci√≥n': {'√ÅCIDO':1,'ACEITE SINT√âTICO':2},
            'L√≠quido de Frenos': {'ACEITE SINT√âTICO':1,'√ÅCIDO':2},
            'L√≠quido de Transmisi√≥n': {'√ÅCIDO':1,'ACEITE SINT√âTICO':3},
            'Neum√°tico': {'ACERO':2,'GOMA':5},
            'Pastillas de Freno': {'GOMA':2,'ACERO':3},
            'Refrigerante': {'PL√ÅSTICO':1,'√ÅCIDO':2},
            'Refrigerante de Bater√≠a': {'PL√ÅSTICO':1,'√ÅCIDO':2},
            'Cableado de Alto Voltaje': {'FIBRA DE CARBONO':1,'PIEZAS ELECTR√ìNICAS':4,'LAT√ìN':5}
          },

          // Mejoras de rendimiento
          rendimiento: {
            'Suspensi√≥n': {'FIBRA DE CARBONO':2,'ALUMINIO':2,'GOMA':2,'ACERO':3},
            'Turbo': {'PIEZAS ELECTR√ìNICAS':5,'ALUMINIO':1,'LAT√ìN':1,'ACERO':2,'FIBRA DE CARBONO':3,'VIDRIO':1},
            'Frenos (Rendimiento)': {'FIBRA DE CARBONO':1,'LAT√ìN':1,'GOMA':2,'ACERO':3},
            'Motor': {'PIEZAS ELECTR√ìNICAS':2,'FIBRA DE CARBONO':2,'LAT√ìN':3,'ACERO':4,'ALUMINIO':6,'ACEITE SINT√âTICO':10},
            'Transmisi√≥n (Rendimiento)': {'ACEITE SINT√âTICO':10,'ALUMINIO':2,'VIDRIO':2,'LAT√ìN':3,'ACERO':4},
            'Blindaje': {'LAT√ìN':1,'GOMA':2,'FIBRA DE CARBONO':3,'ALUMINIO':4,'ACERO':6}
          },

          // Modificaciones cosm√©ticas
          cosmeticos: {
            'Interior': {'ACEITE SINT√âTICO':1,'GOMA':2,'LAT√ìN':4},
            'Exterior': {'VIDRIO':1,'LAT√ìN':3,'ALUMINIO':4},
            'Techo': {'FIBRA DE CARBONO':1,'ALUMINIO':2,'ACERO':3},
            'Luces': {'PIEZAS ELECTR√ìNICAS':2,'VIDRIO':2,'PL√ÅSTICO':2},
            'Chasis': {'FIBRA DE CARBONO':2,'ALUMINIO':3,'ACERO':5},
            'Livery': {'√ÅCIDO':1,'ACEITE SINT√âTICO':2,'PL√ÅSTICO':3},
            'Extras': {'PIEZAS ELECTR√ìNICAS':1,'ALUMINIO':1,'LAT√ìN':3},
            'Cap√≥': {'FIBRA DE CARBONO':1,'ALUMINIO':2,'ACERO':3},
            'Aler√≥n': {'PL√ÅSTICO':1,'ALUMINIO':2,'FIBRA DE CARBONO':3},
            'Claxon': {'PIEZAS ELECTR√ìNICAS':1,'LAT√ìN':2,'PL√ÅSTICO':2},
            'Tinte Ventanas': {'√ÅCIDO':1,'ACEITE SINT√âTICO':1,'VIDRIO':2},
            'Parachoques Delantero': {'GOMA':1,'LAT√ìN':3,'ACERO':4},
            'Faldones': {'ALUMINIO':1,'ACERO':2,'LAT√ìN':3},
            'Rejilla': {'LAT√ìN':1,'ACERO':2,'ALUMINIO':2},
            'Parachoques Trasero': {'GOMA':1,'LAT√ìN':3,'ACERO':4},
            'Humo de Rueda': {'√ÅCIDO':1,'ACEITE SINT√âTICO':2,'GOMA':2},
            'Llantas': {'GOMA':1,'ACERO':2,'ALUMINIO':4},
            'Pintura': {'ALUMINIO':1,'√ÅCIDO':2,'ACEITE SINT√âTICO':2},
            'Neones': {'PIEZAS ELECTR√ìNICAS':3,'VIDRIO':2,'HIERRO':3,'FIBRA DE CARBONO':2},
            'Guardabarros': {'ALUMINIO':1,'LAT√ìN':2,'ACERO':3},
            'Escape': {'GOMA':1,'ALUMINIO':2,'ACERO':3},
            'Matr√≠cula': {'ACERO':1,'ALUMINIO':2,'LAT√ìN':2}
          },

          // Kits
          kits: {
            'Kit de Limpieza': {'VIDRIO':3,'GOMA':5,'ALUMINIO':5,'ACEITE SINT√âTICO':8},
            'Kit de Reparaci√≥n': {'PIEZAS ELECTR√ìNICAS':1,'GOMA':2,'LAT√ìN':2,'ACERO':3},
            'Cadenas para Nieve': {'ACERO':5,'ALUMINIO':10}
          }
        },

        // ==========================================
        // PRECIOS DE VENTA
        // ==========================================
        prices: {
          // Precios de partes principales (ACTUALIZADOS)
          principales: {
            'Alternador': 96,
            'Bloque Motor': 150,
            'Bomba de Direcci√≥n': 152,
            'Carrocer√≠a': 150,
            'Frenos': 80,
            'Inyectores': 88,
            'Radiador': 120,
            'Tanque Gasolina': 150,
            'Transmisi√≥n': 168,
            'Bater√≠a El√©ctrica': 184,
            'Motor El√©ctrico': 200,
            'Rueda de Veh√≠culo': 96
          },

          // Precios de partes de servicio (ACTUALIZADOS)
          servicio: {
            'Filtro de Aceite': 24,
            'Buj√≠a': 40,
            'Correa de Transmisi√≥n': 40,
            'Filtro de Aire': 24,
            'Filtro de Combustible': 40,
            'L√≠quido de Direcci√≥n': 24,
            'L√≠quido de Frenos': 24,
            'L√≠quido de Transmisi√≥n': 32,
            'Neum√°tico': 56,
            'Pastillas de Freno': 40,
            'Refrigerante': 24,
            'Refrigerante de Bater√≠a': 24,
            'Cableado de Alto Voltaje': 80
          },

          // Precios de kits (ACTUALIZADOS)
          kits: {
            'Kit de Limpieza': 200,
            'Kit de Reparaci√≥n': 350,
            'Cadenas para Nieve': 150,
          }
        },

        // ==========================================
        // ESTADO DE LA APLICACI√ìN
        // ==========================================
        selected: {},              // Piezas seleccionadas
        quantities: {},            // Cantidades de cada pieza
        materialTotals: {},        // Totales de materiales calculados
        salesSub: {                // Subtotales de ventas
          principales: 0, 
          servicio: 0
        },
        missingPrices: [],         // Piezas sin precio asignado
        showDiscountPopup: false,  // Control popup de descuento
        showPricesPopup: false,    // Control popup TAKA
        showAichaPopup: false,     // Control popup AICHA
        discountActive: false,     // Estado del descuento
        discountPercent: 0,        // Porcentaje de descuento
        discountName: '',          // Nombre del descuento

        // ==========================================
        // INICIALIZACI√ìN
        // ==========================================
        init() { 
          this.calc(); 
        },

        // ==========================================
        // ACTUALIZAR CANTIDAD AL MARCAR/DESMARCAR
        // ==========================================
        updateQty(name) {
          if (this.selected[name]) {
            this.quantities[name] = 1;  // Inicializar en 1
          } else {
            delete this.quantities[name];  // Eliminar si se desmarca
          }
          this.calc();
        },

        // ==========================================
        // CALCULAR TOTALES DE MATERIALES
        // ==========================================
        calc() {
          // Reiniciar totales
          this.materialTotals = {};
          this.materialOrder.forEach(m => this.materialTotals[m] = 0);

          // Combinar todas las categor√≠as
          const all = {
            ...this.data.principales, 
            ...this.data.servicio, 
            ...this.data.rendimiento, 
            ...this.data.cosmeticos,
            ...this.data.kits
          };

          // Calcular materiales de piezas seleccionadas
          for (const [name, on] of Object.entries(this.selected)) {
            if (on && all[name]) {
              const qty = Math.max(1, Number(this.quantities[name]) || 1);
              
              // Sumar materiales multiplicados por cantidad
              for (const [mat, amt] of Object.entries(all[name])) {
                this.materialTotals[mat] = (this.materialTotals[mat] || 0) + (amt * qty);
              }
            }
          }

          // Calcular precios de venta
          this.calcSales();
        },

        // ==========================================
        // CALCULAR SUBTOTALES DE VENTAS
        // ==========================================
        calcSales() {
          this.salesSub.principales = 0;
          this.salesSub.servicio = 0;
          this.salesSub.kits = 0;
          this.missingPrices = [];

          // Calcular subtotal de Principales
          for (const [name, on] of Object.entries(this.selected)) {
            if (on && this.data.principales[name]) {
              const qty = Math.max(1, Number(this.quantities[name]) || 1);
              const price = this.prices.principales[name];

              if (typeof price === 'number') {
                this.salesSub.principales += price * qty;
              } else {
                if (!this.missingPrices.includes(name)) {
                  this.missingPrices.push(name);
                }
              }
            }
          }

          // Calcular subtotal de Servicio
          for (const [name, on] of Object.entries(this.selected)) {
            if (on && this.data.servicio[name]) {
              const qty = Math.max(1, Number(this.quantities[name]) || 1);
              const price = this.prices.servicio[name];

              if (typeof price === 'number') {
                this.salesSub.servicio += price * qty;
              } else {
                if (!this.missingPrices.includes(name)) {
                  this.missingPrices.push(name);
                }
              }
            }
          }

          // Calcular subtotal de Kits
          for (const [name, on] of Object.entries(this.selected)) {
            if (on && this.data.kits[name]) {
              const qty = Math.max(1, Number(this.quantities[name]) || 1);
              const price = this.prices.kits[name];

              if (typeof price === 'number') {
                this.salesSub.kits += price * qty;
              } else {
                if (!this.missingPrices.includes(name)) {
                  this.missingPrices.push(name);
                }
              }
            }
          }
        },

        // ==========================================
        // MARCAR TODAS LAS PIEZAS
        // ==========================================
        selectAll() {
          const all = {
            ...this.data.principales, 
            ...this.data.servicio, 
            ...this.data.rendimiento, 
            ...this.data.cosmeticos,
            ...this.data.kits
          };

          Object.keys(all).forEach(n => {
            this.selected[n] = true;
            this.quantities[n] = 1;
          });

          this.calc();
        },

        // ==========================================
        // LIMPIAR TODO
        // ==========================================
        clearAll() {
          this.selected = {};
          this.quantities = {};
          this.calc();
        },

        // ==========================================
        // TOGGLE FULL TUNNING (SOLO RENDIMIENTO)
        // ==========================================
        toggleFullTunning() {
          const parts = Object.keys(this.data.rendimiento);
          const allOn = parts.every(p => this.selected[p]);

          // Invertir estado de todas las piezas de rendimiento
          parts.forEach(n => {
            this.selected[n] = !allOn;
            if (this.selected[n]) {
              this.quantities[n] = 1;
            } else {
              delete this.quantities[n];
            }
          });

          this.calc();
        },

        // ==========================================
        // APLICAR DESCUENTO
        // ==========================================
        applyDiscount(percent, name) {
          this.discountActive = true;
          this.discountPercent = percent;
          this.discountName = name;
          this.showDiscountPopup = false;
        },

        // ==========================================
        // QUITAR DESCUENTO
        // ==========================================
        removeDiscount() {
          this.discountActive = false;
          this.discountPercent = 0;
          this.discountName = '';
          this.showDiscountPopup = false;
        },

        // ==========================================
        // OBTENER TOTAL CON O SIN DESCUENTO
        // ==========================================
        getTotal() {
          const total = this.salesSub.principales + this.salesSub.servicio + this.salesSub.kits;
          return this.discountActive 
            ? total * (1 - this.discountPercent / 100) 
            : total;
        },

        // ==========================================
        // FORMATEAR PRECIO
        // ==========================================
        fmt(val) { 
          return '$ ' + Number(val || 0).toFixed(2); 
        }
      };
    }
  </script>
</body>
</html>
